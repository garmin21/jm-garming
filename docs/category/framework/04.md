---
title: ä»é›¶æ‰“é€ ä¸€ä¸ªå±äºè‡ªå·±çš„ Vue3 ç»„ä»¶åº“
date: '2023-04-12'
categories:
    - å·¥ç¨‹åŒ–
tags:
    - å·¥ç¨‹åŒ–
publish: true
---

## ç®€ä»‹

éšç€å‰ç«¯æŠ€æœ¯çš„å‘å±•ï¼Œä¸šç•Œæ¶Œç°å‡ºäº†è®¸å¤šçš„ UI ç»„ä»¶åº“ã€‚ä¾‹å¦‚æˆ‘ä»¬ç†ŸçŸ¥çš„ ElementUI,Vantï¼ŒAntDesign ç­‰ç­‰ã€‚ä½†æ˜¯ä½œä¸ºä¸€ä¸ªå‰ç«¯å¼€å‘è€…ï¼Œä½ çŸ¥é“ä¸€ä¸ª UI ç»„ä»¶åº“æ˜¯å¦‚ä½•è¢«æ‰“é€ å‡ºæ¥çš„å—?

è¯»å®Œè¿™ç¯‡æ–‡ç« ä½ å°†å­¦ä¼š:

-   å¦‚ä½•ä½¿ç”¨ pnpm æ­å»ºå‡ºä¸€ä¸ª Monorepo ç¯å¢ƒ
-   å¦‚ä½•ä½¿ç”¨ vite æ­å»ºä¸€ä¸ªåŸºæœ¬çš„ Vue3 è„šæ‰‹æ¶é¡¹ç›®
-   å¦‚ä½•å¼€å‘è°ƒè¯•ä¸€ä¸ªè‡ªå·±çš„ UI ç»„ä»¶åº“
-   æ‰“åŒ…å¹¶å‘å¸ƒè‡ªå·±çš„ UI ç»„ä»¶åº“

## åŸºç¡€æ¶æ„å›¾

åœ¨ç¼–å†™ç»„ä»¶åº“ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆè¦å¯¹æ•´ä¸ªä»£ç é¡¹ç›®çš„è§£æ„æœ‰ä¸€ä¸ªæ¸…æ™°çš„åˆ’åˆ†ï¼Œä»¥åŠç”¨åˆ°çš„å¤§å¤šæ•°è§„èŒƒï¼Œå’Œä»£ç é£æ ¼æœ‰ä¸€ä¸ªçº¦å®šï¼Œè¿™ç¯‡æ–‡ç« ä¸»è¦å°±å›´ç»•ç€ä¸‹é¢å›¾ä¸­çš„å‡ ä¸ªé—®é¢˜å±•å¼€æè¿°ä¸€ä¸‹ã€‚

<img :src="$withBase('/24.png')" width="100%" height="100%" alt="1" />

### æ­å»º Monorepo ç¯å¢ƒ

æˆ‘ä»¬ä½¿ç”¨ pnpm å½“åšåŒ…ç®¡ç†å·¥å…·ï¼Œç”¨ pnpm workspace æ¥å®ç° monorepoã€‚

æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ `gm-vue3-ui`

```shell
npm install pnpm -g # å…¨å±€å®‰è£…pnpm
pnpm init # åˆå§‹åŒ–package.jsoné…ç½®â½‚ä»¶ ç§æœ‰åº“
pnpm install vue typescript -D # å…¨å±€ä¸‹æ·»åŠ ä¾èµ–

```

æ·»åŠ `.npmrc` æ–‡ä»¶

```shell
shamefully-hoist = true

# å¦‚æœæŸäº›å·¥å…·ä»…åœ¨æ ¹ç›®å½•çš„ node_modules æ—¶æ‰æœ‰æ•ˆï¼Œå¯ä»¥å°†å…¶è®¾ç½®ä¸º true æ¥æå‡é‚£äº›ä¸åœ¨æ ¹ç›®å½•çš„ node_modulesï¼Œå°±æ˜¯å°†ä½ å®‰è£…çš„ä¾èµ–åŒ…çš„ä¾èµ–åŒ…çš„ä¾èµ–åŒ…çš„...éƒ½æ”¾åˆ°åŒä¸€çº§åˆ«ï¼ˆæ‰å¹³åŒ–ï¼‰ã€‚è¯´ç™½äº†å°±æ˜¯ä¸è®¾ç½®ä¸º true æœ‰äº›åŒ…å°±æœ‰å¯èƒ½ä¼šå‡ºé—®é¢˜ã€‚
```

åˆ›å»º`tsconfig.json`æ–‡ä»¶

```json
{
    "compilerOptions": {
        "module": "ESNext", // æ‰“åŒ…æ¨¡å—ç±»å‹ESNext
        "declaration": false, // é»˜è®¤ä¸è¦å£°æ˜â½‚ä»¶
        "noImplicitAny": false, // â½€æŒç±»å‹ä¸æ ‡æ³¨å¯ä»¥é»˜è®¤any
        "removeComments": true, // åˆ é™¤æ³¨é‡Š
        "moduleResolution": "node", // æŒ‰ç…§nodeæ¨¡å—æ¥è§£æ
        "esModuleInterop": true, // â½€æŒes6,commonjsæ¨¡å—
        "jsx": "preserve", // jsx ä¸è½¬
        "noLib": false, // ä¸å¤„ç†ç±»åº“
        "target": "es6", // éµå¾ªes6ç‰ˆæœ¬
        "sourceMap": true,
        "lib": [
            // ç¼–è¯‘æ—¶â½¤çš„åº“
            "ESNext",
            "DOM"
        ],
        "allowSyntheticDefaultImports": true, // å…è®¸æ²¡æœ‰å¯¼å‡ºçš„æ¨¡å—ä¸­å¯¼â¼Š
        "experimentalDecorators": true, // è£…é¥°å™¨è¯­æ³•
        "forceConsistentCasingInFileNames": true, // å¼ºåˆ¶åŒºåˆ†â¼¤â¼©å†™
        "resolveJsonModule": true, // è§£æjsonæ¨¡å—
        "strict": true, // æ˜¯å¦å¯åŠ¨ä¸¥æ ¼æ¨¡å¼
        "skipLibCheck": true, // è·³è¿‡ç±»åº“æ£€æµ‹
        "types": ["unplugin-vue-define-options/macros-global"] // sfc æ·»åŠ  nameå±æ€§çš„åŒ…éœ€è¦çš„
    },
    "exclude": [
        // æ’é™¤æ‰å“ªäº›ç±»åº“
        "node_modules",
        "**/__tests__",
        "dist/**"
    ]
}
```

åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹é¢åˆ›å»º `pnpm-workspace.yaml` é…ç½®æ–‡ä»¶ æˆ–è€… `workspaces: []` ä¸¤ç§æ–¹å¼

```json
{
    "name": "pnpm-example",
    "private": true,
    "version": "1.0.0",
    "description": "",
    "main": "index.js",
    "workspaces": ["packages/**", "docs", "play"],
    "scripts": {
        "build:utils": "pnpm run --filter @example/utils build",
        "build:components": "pnpm run --filter jm-ui build",
        "dev": "pnpm run --filter play dev"
    },
    "author": "",
    "license": "ISC",
    "devDependencies": {
        "less": "^4.1.3",
        "typescript": "^5.0.4",
        "vue": "^3.2.47"
    }
}
```

```yaml
packages:
    - 'packages/**' # å­˜æ”¾æ‰€æœ‰ç»„ä»¶
    - docs # æ–‡æ¡£
    - play # æµ‹è¯•ç»„ä»¶
```

### åˆ›å»ºç»„ä»¶é¢„è§ˆç¯å¢ƒ

```shell
pnpm create vite play --template vue-ts
cd play
pnpm install

```

åœ¨æ ¹ç›®å½•æ–°å»ºä¸€ä¸ª typings ç›®å½•ï¼Œç”¨æ¥å­˜æ”¾é¡¹ç›®ä¸­é€šç”¨çš„è‡ªå®šä¹‰çš„ç±»å‹ï¼Œç„¶åæŠŠç”¨ vite åˆ›å»ºçš„ play/src ä¸‹é¢çš„ vite-env.d.ts ç§»åŠ¨åˆ° typings ä¸‹é¢å»ã€‚

å¯åŠ¨æµ‹è¯•é¡¹ç›®, åœ¨æ ¹ç›®å½•ä¸‹é¢çš„ package.json ä¸‹é¢æ·»åŠ  scripts è„šæœ¬ã€‚

```json
 "scripts": {"dev": "pnpm -C play dev"}
```

æµ‹è¯•ç¯å¢ƒæ­å»ºå®Œæˆï¼Œä¸‹é¢å¼€å§‹æ­å»º packages ä¸‹é¢çš„æ–‡ä»¶ç›®å½•äº†ã€‚

### å¼•å…¥ scssï¼Œå¹¶å¼å®ç° Bem

å…ˆæ‰‹åŠ¨åœ¨æ ¹ç›®å½•ä¸‹é¢åˆ›å»ºå¦‚ä¸‹ç›®å½•

```
packages
    â”œâ”€components # å­˜æ”¾æ‰€æœ‰çš„ç»„ä»¶
    â”œâ”€utils # å­˜æ”¾â¼¯å…·â½…æ³•
    â””â”€theme-chalk # å­˜æ”¾å¯¹åº”çš„æ ·å¼
```

åœ¨æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œåœ¨å„è‡ªçš„æ ¹ç›®å½•ä¸‹é¢åˆ›å»º package.json æ–‡ä»¶ã€‚

```shell
cd components && pnpm init
cd theme-chalk && pnpm init
cd utils && pnpm init


```

è¿™ä¸ªæ—¶å€™éœ€è¦æ‰‹åŠ¨ä¿®æ”¹æ¯ä¸ªåŒ…çš„åå­—ï¼Œè®©å…¶å±äº gm-vue3-ui çš„å­åŒ…ï¼Œæˆ‘ä»¬åˆ†åˆ«è¿›è¡Œä»¥ä¸‹çš„ä¿®æ”¹ï¼Œåœ¨å¯¹åº” package.json æ–‡ä»¶ä¸­ä¿®æ”¹å…¶ name å±æ€§çš„å€¼ã€‚

```
@gm-vue3-ui/components
@gm-vue3-ui/theme-thalk
@gm-vue3-ui/utils


```

ç„¶åæ‰§è¡Œä¸€ä¸‹å‘½ä»¤ï¼Œå°†è¿™ä¸‰ä¸ªåŒ…å®‰è£…åœ¨æ ¹ç›®å½•ä¸‹é¢ï¼Œæ³¨æ„åå­—å“¦ã€‚

```shell
pnpm i @gm-vue3-ui/components -w
pnpm i @gm-vue3-ui/theme-thalk -w
pnpm i @gm-vue3-ui/utils -w

```

ä¸‹é¢æˆ‘ä»¬å°±å¼€å§‹å®ç° Bem è§„èŒƒäº†ã€‚

#### theme-chalk ç›®å½•ç»“æ„

```
theme-chalk
    â”œâ”€â”€ package.json
    â””â”€â”€ src
        â”œâ”€â”€ icon.scss
        â”œâ”€â”€ index.scss
        â”œâ”€â”€ mixins
            â”œâ”€â”€ config.scss
            â””â”€â”€ mixins.scss


```

#### Bem Js å®ç°éƒ¨åˆ†

```ts
// utils/create.ts

// block ä»£ç å—
// element å…ƒç´ 
// modifier è£…é¥°

// z-button
// z-button__element--disable

/**
 *
 * @param prefixName å‰ç¼€å
 * @param blockName ä»£ç å—å
 * @param elementName å…ƒç´ å
 * @param modifierName è£…é¥°ç¬¦å
 * @returnsè¯´ç™½äº† ï¼Œå°±æ˜¯æä¾›ä¸€ä¸ªå‡½æ•°ï¼Œç”¨æ¥æ‹¼æ¥ä¸‰ä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶ç”¨ä¸åŒçš„ç¬¦å·è¿›è¡Œåˆ†éš”å¼€æ¥
 */
function _bem(prefixName, blockName, elementName, modifierName) {
    if (blockName) {
        prefixName += `-${blockName}`
    }
    if (elementName) {
        prefixName += `__${elementName}`
    }
    if (modifierName) {
        prefixName += `--${modifierName}`
    }
    return prefixName
}

/**
 *
 * @param prefixName å‰ç¼€
 * @returns
 */
function createBEM(prefixName: string) {
    const b = (blockName?) => _bem(prefixName, blockName, '', '')
    const e = (elementName) =>
        elementName ? _bem(prefixName, '', elementName, '') : ''
    const m = (modifierName) =>
        modifierName ? _bem(prefixName, '', '', modifierName) : ''
    const be = (blockName, elementName) =>
        blockName && elementName
            ? _bem(prefixName, blockName, elementName, '')
            : ''
    const bm = (blockName, modifierName) =>
        blockName && modifierName
            ? _bem(prefixName, blockName, '', modifierName)
            : ''
    const em = (elementName, modifierName) =>
        elementName && modifierName
            ? _bem(prefixName, '', elementName, modifierName)
            : ''
    const bem = (blockName, elementName, modifierName) =>
        blockName && elementName && modifierName
            ? _bem(prefixName, blockName, elementName, modifierName)
            : ''
    const is = (name, state?) => (state ? `is-${name}` : '')
    return { b, e, m, be, bm, em, bem, is }
}

export function createNamespace(name: string) {
    const prefixName = `z-${name}`
    return createBEM(prefixName)
}
```

```scss
// config.scss

$namespace: 'z';
$element-separator: '__'; // å…ƒç´ è¿æ¥ç¬¦
$modifier-separator: '--'; // ä¿®é¥°ç¬¦è¿æ¥ç¬¦
$state-prefix: 'is-'; // çŠ¶æ€è¿æ¥ç¬¦

* {
    box-sizing: border-box;
}
```

```scss
// mixins.scss

@use 'config' as *;
@forward 'config';

// z-icon
@mixin b($block) {
    $B: $namespace + '-' + $block;
    .#{$B} {
        @content;
    }
}

// z-icon.is-xxx
@mixin when($state) {
    @at-root {
        &.#{$state-prefix + $state} {
            @content;
        }
    }
}

// .z-icon--primary

@mixin m($modifier) {
    @at-root {
        #{& + $modifier-separator + $modifier} {
            @content;
        }
    }
}

// z-icon__header
@mixin e($element) {
    @at-root {
        #{& + $element-separator + $element} {
            @content;
        }
    }
}
```

```scss
// index.scss

@use './icon.scss';
```

```scss
// icon.scss

@use './mixins/mixins.scss' as *;

@keyframes transform {
    from {
        transform: rotate(0deg);
    }
    to {
        transform: rotate(360deg);
    }
}

@include b(icon) {
    width: 1em;
    height: 1em;
    line-height: 1em;
    display: inline-flex;
    vertical-align: middle;
    svg.loading {
        animation: transform 1s linear infinite;
    }
}
```

[ElementUI ç»„ä»¶åº“æ ·å¼ä¸è‡ªåŠ¨åŒ–è®¾è®¡](https://zhuanlan.zhihu.com/p/415399984)

### ç¼–å†™ Icon ç»„ä»¶

ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š

```
components
â”œâ”€â”€ icon
â”‚ â”œâ”€â”€ index.ts
â”‚ â””â”€â”€ src
â”‚ â”œâ”€â”€ icon.ts
â”‚ â””â”€â”€ icon.vue
â””â”€â”€ package.json


```

```vue
<!-- icon.vue -->
<template>
    <i :class="bem.b()" :style="style"><slot></slot></i>
</template>

<script lang="ts" setup>
import { computed, CSSProperties } from 'vue'
import { createNamespace } from '@gm-vue3-ui/utils/create'
import { iconProps } from './icon'
const bem = createNamespace('icon')

defineOptions({ name: 'gmIcon' })

const props = defineProps(iconProps)

const style = computed<CSSProperties>(() => {
    if (!props.color && !props.size) {
        return {}
    }
    return {
        ...(props.size ? { 'font-size': props.size + 'px' } : {}),
        ...(props.color ? { color: props.color } : {}),
    }
})
</script>
```

```ts
// icon.ts

import { ExtractPropTypes, PropType } from 'vue'

export const iconProps = {
    size: [Number, String] as PropType<number | string>,
    color: String,
} as const

export type IconProps = ExtractPropTypes<typeof iconProps>
```

```ts
// index.ts

import _Icon from './src/icon.vue'
import { withInstall } from '@gm-vue3-ui/utils/withInstall'

const Icon = withInstall(_Icon) // ç”Ÿæˆå¸¦æœ‰ install æ–¹æ³•çš„ç»„ä»¶

export default Icon // å¯¼å‡ºç»„ä»¶
export type { IconProps } from './src/icon' // å¯¼å‡ºç»„ä»¶ props çš„ç±»å‹

// è¿™é‡Œä¸ºäº†ç»™ volar ç”¨çš„ï¼Œå…·ä½“å¯ä»¥çœ‹ä¸‹é¢çš„æ–‡æ¡£
declare module 'vue' {
    export interface GlobalComponents {
        ZIcon: typeof Icon
    }
}
```

<img :src="$withBase('/25.png')" width="100%" height="100%" alt="1" />

ç¼–å†™ä¸€ä¸ªæ–¹æ³•ç”¨æ¥æŠŠæˆ‘ä»¬è‡ªå·±ç¼–å†™çš„ç»„ä»¶åŒ…è£…æˆä¸€ä¸ªæ’ä»¶ï¼Œæ–¹ä¾¿ååºå¯¼å…¥ä½¿ç”¨ï¼Œç›´æ¥å¯ä»¥ç”¨`Vue.use()`

utils ä¸‹é¢çš„ç›®å½•ç»“æ„

```
utils
â”œâ”€â”€ create.ts
â”œâ”€â”€ package.json
â””â”€â”€ withInstall.ts

```

```ts
// withInstall.ts
import { Plugin } from "vue";

export type withInstallSFC<T> = T & Plugin;

// ç»™ä¼ å…¥çš„ç»„ä»¶æ·»åŠ ä¸€ä¸ª install æ–¹æ³•
export function withInstall<T>(comp: T) {(comp as withInstallSFC<T>).install = function (app) {const { name } = comp as unknown as { name: string };app.component(name, comp);// è¿™ä¸€å—çš„ç±»å‹è¿˜æœ‰ç‚¹é—®é¢˜ï¼Œè¿˜åœ¨ç ”ç©¶ä¸­ã€‚};return comp as withInstallSFC<T>;
}

```

### ä½¿ç”¨å’Œé¢„è§ˆæˆ‘ä»¬å¼€å‘çš„ç»„ä»¶

æ‰“å¼€ play æ–‡ä»¶ç»ˆç«¯ï¼Œå®‰è£… sass åŒ…

icon æˆ‘ä»¬ä½¿ç”¨ ä¸€ä¸ªä¾èµ–åŒ… [vue-ionicons](https://github.com/mazipan/vue-ionicons)

```vue
<!-- app.vue -->

<script setup lang="ts">
import Icon from '@gm-vue3-ui/components/icon'
// @ts-ignore
import AlertIcon from 'vue-ionicons/dist/ios-alert.vue'
// https://github.com/mazipan/vue-ionicons
</script>

<template>
    <Icon color="#f90"><AlertIcon w="60px" h="60px" /></Icon>
</template>
```

### ä½¿ç”¨ vitepress ç¼–å†™ç»„ä»¶æ–‡æ¡£

[ç›´æ¥åœ¨è¿™é‡Œçœ‹](https://gitee.com/hhhh-ddd/garming-ui/tree/garming21/docs/docs)
[ä½¿ç”¨ VitePress æ­å»ºåŠéƒ¨ç½² vue ç»„ä»¶åº“æ–‡æ¡£](https://juejin.cn/post/7129201521295622152)
[VitePress ä¸­æ–‡ç½‘](https://vitejs.cn/vitepress/)

## å‚è€ƒ

-   [Vue3 + TS æ­å»ºç»„ä»¶åº“](https://blog.csdn.net/web22050702/article/details/127579225)

---

---

---

---

---

---

---

ä¸‹é¢ ğŸ‘‡ åé¢åœ¨æ¥è¡¥å……

### utils æ‰“åŒ… ts æ–‡ä»¶

1. å› ä¸ºé¡¹ç›®é‡‡ç”¨çš„æ˜¯ ts ç¼–å†™ï¼Œæ‰€ä»¥è‡ªç„¶éœ€è¦è¿›è¡Œæ‰“åŒ… ts ,æ‰€ä»¥ä½¿ç”¨ `tsup` å¸®åŠ©æˆ‘ä»¬æ¥æ‰“åŒ… ts

```shell
cd utils

pnpm add tsup

```

2. æ–°å»º tsup æ‰“åŒ…é…ç½®æ–‡ä»¶ `tsup.config.ts`

```ts
import { defineConfig } from 'tsup'

export default defineConfig({
    entry: ['./index.ts'],
    dts: true,
    format: ['esm', 'cjs'],
    clean: true,
})
```

3. åœ¨ index.ts ä¸­ å†™å…¥æµ‹è¯•å‡½æ•°

```ts
export function sum(a: number, b: number) {
    return a + b
}
```

æœ€åæˆ‘ä»¬åœ¨ ä¸»é¡¹ç›®ä¸‹ æ–°å¢ä¸€ä¸ª scripts è„šæœ¬ `"build:utils": "pnpm run --filter @example/utils build",`

### components ç»„ä»¶æ‰“åŒ…

1. è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ vite è¿›è¡Œæ‰“åŒ…ï¼Œæ‰€ä»¥ï¼Œéœ€è¦å®‰è£… `vite` + `@vitejs/plugin-vue`

```ts
import { defineConfig } from 'vite'
import dts from 'vite-plugin-dts'
import vue from '@vitejs/plugin-vue'
export default defineConfig({
    build: {
        lib: {
            entry: 'src/index.ts',
            name: 'jm-ui',
            fileName: (format) => `jm-ui.${format}.js`,
        },
        rollupOptions: {
            external: ['vue'],
            output: {
                globals: {
                    vue: 'Vue',
                },
            },
        },
    },
    plugins: [
        vue(),
        dts({
            tsConfigFilePath: './tsconfig.json',
            outputDir: 'dist',
        }),
    ],
    optimizeDeps: {
        include: ['vue'],
    },
})
```

`vite-plugin-dts` å¸®åŠ©æˆ‘ä»¬æå– d.ts æ–‡ä»¶

2. `src` æ–°å¢ button ç»„ä»¶

```text
-- components
  -- src
    -- button
    -- index.ts
```

3. é…ç½®ä¸‹ package.json

```json
{
    "name": "jm-ui", // ä¿®æ”¹åå­—
    "version": "1.0.0",
    "description": "",
    "main": "dist/jm-ui.umd.js", // æœåŠ¡ç«¯æ”¯æŒ
    "module": "dist/jm-ui.es.js", // es æ”¯æŒ
    "scripts": {
        "build": "vite build"
    },
    "author": "",
    "license": "ISC",
    "typings": "dist/packages/components/src/index.d.ts", // é…ç½®ts ç±»å‹ ä»£ç æç¤º
    "dependencies": {
        "@pnpm-example/utils": "link:../utils", // å¦‚æœéœ€è¦ä½¿ç”¨åˆ°å…¶ä»–ä¾èµ–åŒ…ï¼Œå¯ä»¥è¿™æ ·å­å»ä½¿ç”¨ï¼Œæˆ–è€… åœ¨å½“å‰åŒ… æ‰§è¡Œ pnpm add ../utils
        "@vitejs/plugin-vue": "^4.1.0",
        "vite": "^4.2.1",
        "vite-plugin-dts": "^2.2.0"
    }
}
```

æœ€åæˆ‘ä»¬åœ¨ ä¸»é¡¹ç›®ä¸‹ æ–°å¢ä¸€ä¸ª scripts è„šæœ¬ `"build:components": "pnpm run --filter jm-ui build"`

æœ€åæˆ‘ä»¬åœ¨ ä¸»é¡¹ç›®ä¸‹ æ–°å¢ä¸€ä¸ª scripts è„šæœ¬ `"dev": "pnpm run --filter play dev"`, æ‰§è¡Œè„šæœ¬è‡ªç„¶å°±ä¼šçœ‹åˆ°æ•ˆæœ
