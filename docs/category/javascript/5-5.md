---
title: 5-5 事件机制/Event Loop
date: "2022-05-05"
categories:
  - javascript
tags:
  - javascript
publish: true
sticky: 9
---

## 1. 前言

JavaScript 是一种单线程的编程语言，只有一个调用栈，决定了它在同一时间只能做一件事情。

在 JavaScript 的运行过程中，真正负责执行 JavaScript 代码的始终只有一个线程，通常被称为主线程，各种任务都会用排队的方式来同步执行。这种方式最常见的一个问题就是：如果你尝试执行一段非常耗时的同步代码，浏览器就没办法同时去渲染 GUI，导致界面失去响应，也就是被阻塞了。

于是，要处理阻塞问题，就使用到了 Event Loop 机制的解决方法

## 2. 什么是 Event Loop ？

事件循环（Event Loop） 是让 JavaScript 做到既是单线程，又绝对不会阻塞的核心机制，也是 JavaScript 并发模型（Concurrency Model）的基础，是用来协调各种事件、用户交互、脚本执行、UI 渲染、网络请求等的一种机制

## 3. 任务队列(task queue)

### 1. 什么是队列（Queue）？

特殊之处在于它只允许在表的前端`（front）`进行**删除**操作，而在表的后端`（rear）`进行**插入**操作，和栈一样，队列是一种操作受限制的线性表。进行插入操作的端称为队尾，进行删除操作的端称为队头。 队列中没有元素时，称为空队列。

队列的数据元素又称为队列元素。在队列中插入一个队列元素称为入队，从队列中删除一个队列元素称为出队。因为队列只允许在一端插入，在另一端删除，所以只有最早进入队列的元素才能最先从队列中删除，故队列又称为先进先出`（FIFO—first in first out）`

<img :src="$withBase('/9.webp')" width="100%" height="100%" />

### 2. 同步任务(SyncTask)、异步任务(AsyncTask)

同步任务说白了就是主线程来执行的时候立即就能执行的代码,

```js
var a = 1;

console.log("garming");
```

异步任务，被 宿主环境提供 异步 API 包裹的语句，异步任务的特点就是，不会阻塞代码的执行。而是在某一个特定的条件或时刻触发

```js
setTimeout(() => {
  console.log("garming");
}, 0);
```

**下图：同步和异步的执行机制**
<img :src="$withBase('/10.webp')" width="100%" height="100%" />

### 3. 宏任务(MacroTask)、微任务(MicroTask)

`JS`是单线程的，为了防止一个函数执行时间过长阻塞后面的代码，所以会先将同步代码压入执行栈中，依次执行，将异步代码推入异步队列，异步队列又分为**宏任务队列**和**微任务队列**，因为宏任务队列的执行时间较长，所以微任务队列要优先于宏任务队列。微任务队列的代表就是，`Promise.then`，`MutationObserver`，宏任务的话就是`setImmediate setTimeout setInterval`

**MacroTask（宏任务）**

script 全部代码、setTimeout、setInterval、setImmediate（浏览器暂时不支持，只有 IE10 支持，具体可见 MDN）、I/O、UI Rendering。

**MicroTask（微任务）**

Process.nextTick（Node 独有）、Promise、Object.observe(废弃)、MutationObserver
