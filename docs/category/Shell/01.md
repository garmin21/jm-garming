---
title: Shell 脚本（基础篇）
date: '2024-03-14'
categories:
  - Shell
tags:
  - Shell
publish: true
---

## 1. shell 是什么

1. Shell  可以是一个程序，提供一个与用户对话的环境。这个环境只有一个命令提示符，让用户从键盘输入命令，所以又称为命令行环境（ command line interface ，简写为 CLI ）。 Shell  接收到用户输入的命令，将命令送入操作系统执行，并将结果返回给用户。

2. Shell 也可以是一个命令解释器，解释用户输入的命令。它支持变量、条件判断、循环操作等语法，所以用户可以用 Shell 命令写出各种小程序，又称为脚本 script。这些脚本都通过 Shell 的解释执行，而不通过编译。

3. Shell 还可以是一个工具箱，提供了各种小工具，供用户方便地使用操作系统的功能

4. Shell 这门语言可以帮助我们完成很多自动化任务，例如：保存数据，监测系统的负载，等等。

5. Shell 相比 C 等语言的优势在于它是完全嵌入在 Linux 中的，不需要安装，编译。

6. Shell 有很多种，只要能给用户提供命令行环境的程序，都可以看作是 Shell 。
   - Bourne Shell（sh） ，是目前所有 Shell  的祖先，被安装在几乎所有发源于 Unix  的操作系统上。
   - Bourne Again shell（bash） ，是 sh  的一个进阶版本，比 sh  更优秀， bash  是目前大多数 Linux  发行版以及 macOS  操作系统的默认 Shell 。
   - C Shell（csh） ，它的语法类似 C  语言。
   - TENEX C Shell（tcsh） ，它是 csh  的优化版本。
   - Korn shell（ksh） ，一般在收费的 Unix  版本上比较多见。
   - Z Shell（zsh） ，它是一种比较新近的 Shell ，集 bash 、 ksh  和 tcsh  各家之大成。

关于 Shell 的几个常见命令

1. `echo $SHELL` 可以查看本机正在使用的 Shell ，其中 $SHELL 是环境变量。
2. `cat /etc/shells` 可以查看当前的 Linux 系统安装的所有 Shell 。
3. `chsh` 命令是切换 Shell 类型为 chsh 。

## 2. 编写第一个 shell 脚本

```shell
#!/bin/bash 指定脚本要使用的 Shell 类型为 Bash 。
# ! 被称为 Sha-bang ，或者 Shebang ， Linux 会分析它之后的指令，并载入该指令作为解析器。


echo 'hello word'
```

执行 shell 脚本，如果我们不是 root 用户的话，需要给脚本添加可执行权限才可以运行， `chmod +x hello.sh` 。

增加执行权限后可以执行 `./hello.sh` 来运行该脚本，也可以使用 `bash -x hello.sh` 以调试模式运行脚本。

**系统命令，直接执行 hello.sh 不需要路径**

1. `echo $PATH` 获取查看系统里所有可以被直接执行程序的路径。
2. `sudo cp hello.sh /usr/bin` 将 hello.sh 拷贝到任意一个 path 路径路径中，这里拷贝到 /usr/bin 。
   - 注意： 当重新修改了脚本，需要重新拷贝到 之前拷贝到路径上，否则还是上次的内容

## 3. shell 命令语句

### 1. echo

echo 命令的作用是在屏幕输出一行文本，可以将该命令的参数原样输出。

```sh
echo 'hello word'

# 用 -e 参数使得 echo 可以解析转义字符
echo -e 'hello \n word'
```

### 2. 引号

1. 单引号 '' ，单引号用于保留字符的字面含义，各种特殊字符在单引号里面，都会变为普通字符，比如星号\* 、美元符号$ 、反斜杠 \ 等。
2. 双引号 "" ，双引号比单引号宽松，大部分特殊字符在双引号里面，都会失去特殊含义，变成普通字符。三个特殊字符除外：美元符号 $ 、反引号 ``` 和反斜杠 \
3. 反引号 要求 Shell 执行被它括起来的内容，例如执行 echo`pwd`，相当于直接执行 pwd 命令 。

### 3. 变量

Bash 没有数据类型的概念，所有的变量值都是字符串。

#### 1. 环境变量

环境变量是 Bash 环境自带的变量，进入 Shell 时已经定义好了，可以直接使用。它们通常是系统定义好的，可以理解成全局的常量。

BASHPID： Bash  进程的进程 ID 。
EDITOR：默认的文本编辑器。
HOME：用户的主目录。
HOST：当前主机的名称。
LANG：字符集以及语言编码，比如 zh_CN.UTF-8。
PATH：由冒号分开的目录列表，当输入可执行程序名后，会搜索这个目录列表。
PWD：当前工作目录。
SHELL： Shell  的名字。
TERM：终端类型名，即终端仿真器所用的协议。
UID：当前用户的 ID  编号。
USER：当前用户的用户名

```sh

# 显示所有的环境变量
env

# 显示 由冒号分开的目录列表
echo $PATH

# 自定义环境变量
```

#### 2. 声明变量

1. 字母、数字和下划线字符组成。
2. 第一个字符必须是一个字母或一个下划线，不能是数字。
3. 不允许出现空格和标点符号。

```sh
message="Hello World" # message 为变量名

# 使用变量 打印 Hello World
echo $message
```

#### 3. 参数变量

可以这样调用我们的脚本文件 ./hello.sh 参数 1 参数 2 ... 其中参数 1、参数 2...被称为“参数变量”。

1. $# 参数的数目
2. $0 被运行的脚本名称
3. $1 第一个参数
4. $2 第二个参数
5. $N 第 N 个参数

```sh
echo "脚本名称：$0， 参数是 $1 $2 $3"

```

**使用 shift 命令来挪移变量值：**

同样是 $1 ，通过 shift 使得它的值会变成原本是 $2 的值。因此 shift 命令常被用在循环中，使得参数一个接一个地被处理。

```sh

echo "脚本名称：$0， 参数是 $1" # 参数是 1
shift
echo "脚本名称：$0， 参数是 $1" # 参数是 2
```

### 4. 数组

```sh
# 定义数组
array=('v1' 'v2' 'v3')

# 访问数组
echo ${array[2]} # 访问数组（bash下标是从0开始）
echo ${array[*]} # 使用*号访问数组所有的值
```

### 5. 数学运算

在 Bash 中，所有的变量都是字符串， Bash 本身不会操作数字，因此它也不会做运算。不过可以使用 let 命令来实现运算。

bash 中可用的运算符有以下几种 加法 减法 乘法 除法 乘方 除余

```sh
let "a = 5"
let "b = 2"
let "c = a + b"
let "d = c ** 2" # 乘方
let "e = d % 2" #  除余

echo "c = $c" # 输出 c = 7
echo "d = $d" # 输出 d = 49
echo "e = $e" # 输出 e = 1
```

### 6. read

请求输入， read 命令读取到的文本会立即被存储在一个变量里。 也可以同时接收一个或者多个

```sh
read name age sex
echo "hello $name $age $sex!"


# 使用 -p 参数， 显示提示信息
read -p "请输入你的姓名" name
echo "hello $name!"

# 用 -n 参数可以限制用户输入的字符串的最大长度（字符数）
read -p "请输入您的姓名：" -n 5 name

# 用 -t 参数可以限定用户的输入时间（单位：秒）超过这个时间，就不读取输入了。
read -p "请输入您的姓名：" -n 5 -t 10 name

# 用 -s 参数可以隐藏输入内容，在用户输入密码时使用。
read -p "请输入密码：" -s password
```

执行 ./read.sh 时，会发现光标处于接收输入的状态，此时我们输入一个字符串 lion 按下回车键后，控制台会打印出 hello lion 。
