---
title: 11-19 动态路由
date: "2022-11-19"
categories:
  - VUE
tags:
  - VUE
publish: true
---

## 动态路由

说一件很蠢的事，我好久没做过动态路由，在公司办公时，遇到后端已经帮我处理好了一颗树结构给我的数据，我只需要转为 vue-router 的结构就行了，结果弄了半天，头脑发热。但是就是弄不出来，这一至让我认为我是不是，sb 了 😭

## 总结下动态路由是怎么做的

动态路由就是很简单的一句话，就是把 后端返回的 数据，先转换为一个 tree ，然后，再将 tree 生成 一个路由的 tree, 就这么简单，
后面就根据这个生成的路由，渲染 菜单，你可以使用 element-ui 自带的，也可以 自己写一个 递归组件， 但是你的本地，是要有对应结构 的.vue 文件，不能光有 跳转路径，没有文件

- 在 vue-router 3x 中你可以通过 router.addRoutes() 去添加到 vue-router 路由中去

```js
export function generateRouters(data) {
  return Array.from(data).map((route) => {
    let _route = {};
    _route.name = route.name;
    _route.path = route.urlAddr;
    _route.icon = route.menuIcon;
    _route.component = () => import(`@/views${route.name}`);

    if (route.children) {
      _route.children = generateRouters(route.children);
    }
    return _route;
  });
}
router.addRoutes(generateRouters(data));
```

- vue-router 4x 的版本就去除了这个方法 ，只能一个一个加， 通过遍历 tree 一个一个加入

## 生成树结构的方式有很多种

### 1. filter

```js
function arrToTree(souse) {
  if (!Array.isArray(souse)) {
    return souse;
  }
  // 将根节点0返回
  return souse.filter((node) => {
    // 不断的去寻找对应的一个子节点
    const children = souse.filter((item) => {
      return node.id === item.pid;
    });
    // 子节点有值的话，就直接 设置 children 为找到的 children
    if (children.length) {
      node.children = children;
    }
    return node.pid === 0;
  });
}
```

### 2. 建立 ID 映射 关系

```js
function invertTrees(sourceArr) {
  let obj = {}; // 建立id 和对象的关系
  sourceArr.forEach((item) => (obj[item.id] = item));

  const result = [];
  sourceArr.forEach((node) => {
    // 根节点
    if (node.pid === 0) {
      return result.push(node);
    }

    // obj里面 pid 去找 id
    obj[node.pid].children = obj[node.pid].children || [];
    // 这个时候 node.pid 和 obj[id] 是一样的， 这个时候，就是它的子集
    obj[node.pid].children.push(node);
  });

  return result;
}
```

### 3. 换了种写发 与 2 同样的思路

```js
function convert(list) {
  const result = [];
  const map = list.reduce((pre, cur) => {
    pre[cur.id] = cur;
    return pre;
  }, {});

  for (let item of list) {
    if (item.pid === 0) {
      result.push(item);
      continue;
    }
    if (item.pid in map) {
      // id 处理成对象后，pai 对应了 id
      const parent = map[item.pid];
      parent.children = parent.children || [];
      parent.children.push(item);
    }
  }

  return result;
}
```

### 4. map 的方式 代替 object

```js
// key 相同 ，后面的会覆盖前面的
function mapConvert(list) {
  const result = [];
  // 大数据情况下，这边会查找更快，数组的效率会比较慢
  const map = new Map();
  list.forEach((item) => {
    map.set(item.id, item);
  });

  for (const item of list) {
    if (item.pid === 0) {
      result.push(item);
      continue;
    }
    if (map.has(item.pid)) {
      const parent = map.get(item.pid);

      parent.children = parent.children || [];

      parent.children.push(item);
    }
  }

  return result;
}
```

## 如何将 tree 转 为 arr ?

```js
function treeToArr(data) {
  // reduce 不断的去合并 一个对对象
  return data.reduce((pre, cur) => {
    const { id, value, pid, children = [] } = cur;
    // concat 可以合并多个，
    return pre.concat([{ id, value, pid }], treeToArr(children));
  }, []);
}
```

---

最后，一件事，就是告诫下自己，做事一定要踏实
